CREATE TABLE organizations (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  subdomain VARCHAR(100) UNIQUE NOT NULL,
  logo_url VARCHAR(500),
  settings JSON,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

ALTER TABLE users ADD COLUMN organization_ids JSON NOT NULL DEFAULT ('[]');

ALTER TABLE users ADD COLUMN current_organization_id INT NULL;

ALTER TABLE users
ADD CONSTRAINT fk_users_current_org
  FOREIGN KEY (current_organization_id) REFERENCES organizations(id)
  ON DELETE SET NULL;